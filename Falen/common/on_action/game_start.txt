# Called from code after history generation
# Empty scope
on_game_start = {
	events = {
		#Guaranteed historical artifacts fixed spawning
		debug_portraits.1 					# Debug portraits for animation testing
	}
	effect = {
		### INITIALIZE CULTURAL GROUPS ###
		every_culture_global = {
			#fs_initialize_culture_effect = yes
		}
		if = {
			limit = { NOT = { has_global_variable = startup_settings } }
			set_global_variable = { name = election_date value = 2445 }
			set_global_variable = { name = election_term value = 1 }
			set_global_variable = { name = startup_settings value = yes }
			set_global_variable = { name = imperial_authority value = 20.00 }
		}
		### HRE SETUP ###
		if = {
			limit = { exists = title:e_hec.holder }
			title:e_hec.holder = {
				every_vassal = {
					limit = {
						vassal_contract_has_modifiable_obligations = yes
					}
					vassal_contract_decrease_obligation_level = feudal_government_taxes
					vassal_contract_decrease_obligation_level = feudal_government_levies
					set_vassal_contract_modification_blocked = no
				}
			}
			add_to_global_variable_list = {
				name = hre_elector_list
				target = title:c_iksan
			}
			add_to_global_variable_list = {
				name = hre_elector_list
				target = title:d_namwon
			}
			add_to_global_variable_list = {
				name = hre_elector_list
				target = title:c_gongju
			}
			add_to_global_variable_list = {
				name = hre_elector_list
				target = title:d_jeonju
			}
			add_to_global_variable_list = {
				name = hre_elector_list
				target = title:d_buyeo
			}
			add_to_global_variable_list = {
				name = hre_elector_list
				target = title:d_jeongeup
			}
			add_to_global_variable_list = {
				name = hre_elector_list
				target = title:d_nonsan
			}
			hre_elector_list_save_effect = yes
		}

		### RELIGIOUS THINGS ###
		# Set up Holy Site Buildings to be buildable in Holy Sites
		religion:islam_religion = {
			every_faith = {
				every_holy_site = {
					limit = {
						title_province = {
							has_special_building_slot = no
						}
					}
					title_province = {
						add_special_building_slot = holy_site_mosque_01
					}
				}
			}
		}
		every_religion_global = {
			limit = {
				OR = {
					this = religion:christianity_religion
					this = religion:protestant_religion
				}
			}
			every_faith = {
				every_holy_site = {
					limit = {
						title_province = {
							has_special_building_slot = no
						}
					}
					title_province = {
						add_special_building_slot = holy_site_cathedral_01
					}
				}
			}
		}
		religion:buddhism_religion = {
			every_faith = {
				every_holy_site = {
					limit = {
						title_province = {
							has_special_building_slot = no
						}
					}
					title_province = {
						add_special_building_slot = holy_site_indian_grand_temple_01
					}
				}
			}
		}		
		every_religion_global = {
			limit = {
				is_in_family = rf_pagan
			}
			every_faith = {
				every_holy_site = {
					limit = {
						title_province = {
							has_special_building_slot = no
						}
					}
					title_province = {
						add_special_building_slot = holy_site_pagan_grand_temple_01
					}
				}
			}
		}
		every_religion_global = {
			every_faith = {
				every_holy_site = {
					limit = {
						title_province = {
							has_special_building_slot = no
						}
					}
					title_province = {
						add_special_building_slot = holy_site_other_grand_temple_01
					}
				}
			}
		}

		# Pagans that start pre-reformed
		## Bon has already been reformed into new bon.
		#faith:old_bon = { 
		#	set_variable = { name = has_been_reformed }
		#}

		# Mark some faiths to block conversion till specific decisions are taken.


		### COA ###
		
		### GRANDEUR ###
		#Royal Court: Set starting Grandeur to be the same as Expected
		if = {
			limit = {
				has_dlc_feature = royal_court
			}
			every_character_with_royal_court = {
				set_current_court_grandeur = court_grandeur_minimum_expected
				apply_hold_court_grace_effect = yes
				# Stops Hold Court reminders at game start
				set_variable = {
					name = last_hold_court_date
					value = current_year
				}
			}
		}
	}
}
# Like on_game_start, except it is called once the host (or player, in single player) exits the lobby. Good for anything where you need to know who the players are, or what the game rules are
on_game_start_after_lobby = {
	effect = {
		### GAME RULE: VIEW ON SAME-SEX RELATIONS
		if = {
			limit = { has_game_rule = accepted_same_sex_relations }
			game_rule_accepted_same_sex_relations_effect = yes
		}

		### GAME RULE: RANDOM RULER PLACEMENT
		if = {
			limit = { NOT = { has_game_rule = random_ruler_placement_off } }
			game_rule_random_ruler_placement_effect = yes
		}

		### GAME RULE: RANDOMIZE FAITH
		if = {
			limit = { has_game_rule = randomized_faiths_on }
			game_rule_randomize_faith_effect = yes
		}

		### GAME RULE: FAITH ACCEPTANCE
		if = {
			limit = { has_game_rule = full_faith_acceptance }
			game_rule_faith_acceptance_effect = yes
		}

		### GAME RULE: GENDER EQUALITY ###
		if = {
			limit = { has_game_rule = full_gender_equality }
			game_rule_full_gender_equality_effect = yes
		}
		else_if = {
			limit = { has_game_rule = inversed_gender_equality }
			game_rule_inversed_gender_equality_effect = yes #todo fix
		}

		### GAME RULE: SEXUALITY DISTRIBUTION ###
		if = {
			limit = { NOT = { has_game_rule = sexuality_distribution_default } }
			game_rule_sexuality_distribution_effect = yes
		}
		else = { # So that children 10+ starts with a sexuality
			child_sexuality_distribution_effect = yes
		}
		
		every_player = {
			trigger_event = startup.1
		}
		title:e_donghae.holder = {
			trigger_event = donghae.1
		}
		title:e_north_korea.holder = {
			trigger_event = sun_from_north.1
		}
		title:c_hoengseong.holder = {
			trigger_event = gw_mgga.1
		}
		every_player = {
			limit = {
				top_liege = character:9008
			}
			trigger_event = yalu_civil_war.1
		}
		title:e_yalu.holder = {
			trigger_event = {
				id = yalu_civil_war.2
				days = 7
			}
		}
		every_county = {
			fs_initialize_technologies_effect = yes
		}
		tech_metallurgy_init = yes
		tech_siege_init = yes
		tech_horseback_riding_init = yes
		tech_fortification_init = yes
		tech_conscription_init = yes
		tech_archery_init = yes
		tech_military_organization_init = yes
		### PRESTIGE/PIETY/RENOWN ON START
		character:1 = { add_prestige = 1500 }
		character:2 = { add_prestige = 1000 }
		title:k_gorlos.holder = { add_prestige = 2000 }
		### HOLD COURT STARTING GRACE
		every_character_with_royal_court = {
			set_variable = {
				name = hold_court_cooldown
	 			days = standard_hold_court_cooldown_time
	 		}
		}

		
		#Set starting cultural acceptance
		# Custom ruler under the HRE should have lowered feudal obligations
		if = {
			limit = { exists = title:e_hec.holder }
			title:e_hec.holder = {
				every_vassal = {
					limit = {
						is_ai = no
						vassal_contract_has_modifiable_obligations = yes
					}
					vassal_contract_decrease_obligation_level = feudal_government_taxes
					vassal_contract_decrease_obligation_level = feudal_government_levies
					set_vassal_contract_modification_blocked = no
				}
			}
		}
	}

	events = {
		game_rule.1000	#Autopopulate families.
		historical_artifacts.0023			# Historical Artifacts Generator
	}
}